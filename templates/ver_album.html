{% extends 'base.html' %}

{% block title %}√Ålbum: {{ carpeta }}{% endblock %}

{% block content %}
<main class="fondo-ver-album">
    <!-- T√≠tulo del √°lbum -->
    <h2 class="titulo-album">{{ carpeta }}</h2>

    <!-- Formulario para subir fotos (solo logueado) -->
    {% if session.get('logueado') %}
    <form method="POST" action="{{ url_for('upload', carpeta=carpeta) }}" enctype="multipart/form-data" style="text-align:center; margin-top:20px;">
        <input type="file" name="fotos" multiple required>
        <button type="submit" class="boton-galeria">üì§ Subir fotos</button>
    </form>
    {% endif %}

    <!-- Grid de fotos -->
    <div class="galeria-grid">
        {% if imagenes %}
            {% for foto in imagenes %}
            <img src="{{ foto['url'] }}" alt="Foto" class="foto-galeria" onclick="abrirLightbox('{{ foto['url'] }}')">
            {% endfor %}
        {% else %}
            <p style="color:white; margin-top:20px;">Este √°lbum est√° vac√≠o. ¬°Sub√≠ tus primeras fotos!</p>
        {% endif %}
    </div>


<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <button class="cerrar" onclick="cerrarLightbox()">‚úñ</button>
    <img id="lightbox-img" src="" alt="Foto ampliada">
    <button class="siguiente" onclick="siguienteFoto()">‚û°</button>
</div>

<script>
let fotos = [];
let indiceActual = 0;

function abrirLightbox(url) {
    const imagenes = document.querySelectorAll('.foto-galeria');
    fotos = Array.from(imagenes).map(img => img.src);
    indiceActual = fotos.indexOf(url);

    document.getElementById('lightbox-img').src = fotos[indiceActual];
    document.getElementById('lightbox').classList.add('show');
}

function cerrarLightbox() {
    document.getElementById('lightbox').classList.remove('show');
}

function siguienteFoto() {
    indiceActual = (indiceActual + 1) % fotos.length;
    document.getElementById('lightbox-img').src = fotos[indiceActual];
}
</script>
{% endblock %}
