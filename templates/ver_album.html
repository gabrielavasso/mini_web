{% extends 'base.html' %}

{% block title %}Álbum: {{ carpeta }}{% endblock %}

{% block content %}
<main class="fondo-ver-album">

    <!-- Título del álbum -->
    <h2 class="titulo-album">Álbum: {{ carpeta }}</h2>

    <!-- Mensaje de éxito -->
    {% if mensaje %}
    <div class="mensaje-exito">
        {{ mensaje }}
    </div>
    {% endif %}

    <!-- Galería de fotos -->
    <div class="galeria-grid">
        {% for imagen in imagenes %}
        <div class="foto-wrapper">
            <!-- Imagen -->
            <img src="{{ imagen.url }}" alt="Foto" class="foto-galeria" onclick="abrirLightbox(this)">

            <!-- Botón eliminar solo si hay sesión -->
            {% if session.get('logueado') %}
            <form method="POST" action="{{ url_for('eliminar_fotos') }}" class="form-eliminar-foto">
                <input type="hidden" name="carpeta" value="{{ carpeta }}">
                <input type="hidden" name="nombre" value="{{ imagen.url }}">
                <button type="submit" class="btn-eliminar-foto" title="Eliminar">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </form>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <!-- Botón volver a galería -->
    <div class="volver-centro">
        <a href="{{ url_for('galeria') }}" class="boton-volver-dorado">
            <i class="fas fa-heart"></i> Volver a la galería
        </a>
    </div>

    <!-- Botón volver al inicio -->
    <div class="volver-centro">
        <a href="{{ url_for('index') }}" class="boton-volver-dorado">
            <i class="fas fa-heart"></i> Volver al comienzo
        </a>
    </div>

    <!-- Lightbox para ver imagen ampliada -->
    <div id="lightbox" class="lightbox">
        <button class="cerrar" onclick="cerrarLightbox()">&times;</button>
        <img id="lightbox-img" src="" alt="Imagen ampliada">
        <button class="siguiente" onclick="siguienteFoto()">&#8594;</button>
    </div>

</main>

<script>
let currentIndex = 0;
let fotos = [];

function abrirLightbox(img) {
    fotos = Array.from(document.querySelectorAll('.foto-galeria')).map(f => f.src);
    currentIndex = fotos.indexOf(img.src);
    document.getElementById('lightbox-img').src = img.src;
    document.getElementById('lightbox').classList.add('show');
}

function cerrarLightbox() {
    document.getElementById('lightbox').classList.remove('show');
}

function siguienteFoto() {
    currentIndex = (currentIndex + 1) % fotos.length;
    document.getElementById('lightbox-img').src = fotos[currentIndex];
}
</script>
{% endblock %}
